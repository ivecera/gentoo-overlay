From 0effbd3a35fe4941dd980a6db74a158c3ac0adca Mon Sep 17 00:00:00 2001
From: Root <root@cera.cz>
Date: Mon, 14 Nov 2016 14:44:11 +0100
Subject: [PATCH 1/3] NR_ANON_PAGES renamed to NR_ANON_MAPPED

---
 vmmon-only/linux/hostif.c | 6 +++++-
 1 file changed, 5 insertions(+), 1 deletion(-)

diff --git a/vmmon-only/linux/hostif.c b/vmmon-only/linux/hostif.c
index 6a0194e..5f7fad2 100644
--- a/vmmon-only/linux/hostif.c
+++ b/vmmon-only/linux/hostif.c
@@ -1595,7 +1595,11 @@ HostIF_EstimateLockedPageLimit(const VMDriver* vm,                // IN
                               global_page_state(NR_SLAB_UNRECLAIMABLE) +
                               global_page_state(NR_UNEVICTABLE) +
                               hugePages + reservedPages;
-   unsigned int anonPages = global_page_state(NR_ANON_PAGES); 
+#if LINUX_VERSION_CODE > KERNEL_VERSION(4, 7, 99)
+   unsigned int anonPages = global_page_state(NR_ANON_MAPPED);
+#else
+   unsigned int anonPages = global_page_state(NR_ANON_PAGES);
+#endif
    unsigned int swapPages = BYTES_2_PAGES(linuxState.swapSize);
 
    if (anonPages > swapPages) {
-- 
2.7.3

